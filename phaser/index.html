<!DOCTYPE html>
<html>
<head>
    <script src="phaser.min.js"></script>
</head>
<body>

    <script>

    var game = new Phaser.Game(
    	800, 
    	600, 
    	Phaser.CANVAS, 
    	'', 
   		{
   			preload: preload, 
   			create: create,
   			update: update
   		}
   	);


    function preload() {
    	game.load.image('button1', 'button1.png');
    	game.load.image('button2', 'button2.png');
    	game.load.image('button3', 'button3.png');
    	game.load.atlasXML('seacreatures', 'seacreatures.png', 'seacreatures.xml');
    	game.load.image('undersea', 'undersea.jpg');
    	game.load.image('coral', 'seabed.png');
    	game.load.image('computer', 'computer.png');
    	game.load.image('email', 'email.png');
    }

	var jellyfish;
	var crab;
	var greenJellyfish;
	var octopus;
	var purpleFish;
	var seahorse;
	var squid;
	var stingray;
	var flyingfish;
	
	var computer;
	var email;
	
	var button1;
	var button2;
	
	var objects = [];
	var state = 1;
	var steep5_crab_jumps = 5;

	function create() {
		game.add.image(0, 0, 'undersea');
		game.add.image(0, 466, 'coral');
		
		octopus = game.add.sprite(200, 420, 'seacreatures');
		octopus.animations.add('swim', Phaser.Animation.generateFrameNames('octopus', 0, 24, '', 4), 30, true);
		octopus.animations.play('swim');
		
		jellyfish = game.add.sprite(280, 420, 'seacreatures');
		jellyfish.animations.add('swim', Phaser.Animation.generateFrameNames('blueJellyfish', 0, 32, '', 4), 30, true);
  		jellyfish.animations.play('swim');
  		  				  		
  		greenJellyfish = game.add.sprite(350, 420, 'seacreatures');
		greenJellyfish.animations.add('swim', Phaser.Animation.generateFrameNames('greenJellyfish', 0, 39, '', 4), 30, true);
		greenJellyfish.animations.play('swim');
		
		seahorse = game.add.sprite(510, 450, 'seacreatures');
		seahorse.anchor.setTo(.5, .5);
		seahorse.scale.x *= -1;
		seahorse.animations.add('swim', Phaser.Animation.generateFrameNames('seahorse', 0, 5, '', 4), 30, true);
		seahorse.animations.play('swim');
		
		stingray = game.add.sprite(620, 460, 'seacreatures');
		stingray.anchor.setTo(.5, .5);
		stingray.scale.x *= -.8;
		stingray.scale.y *= -.8;
		stingray.animations.add('swim', Phaser.Animation.generateFrameNames('stingray', 0, 23, '', 4), 30, true);
		stingray.animations.play('swim');
				

		purpleFish = game.add.sprite(700, 400, 'seacreatures');
		purpleFish.animations.add('swim', Phaser.Animation.generateFrameNames('purpleFish', 0, 20, '', 4), 30, true);
		purpleFish.animations.play('swim');
	  		
  		crab = game.add.sprite(-150, 450, 'seacreatures');
		crab.animations.add('swim', Phaser.Animation.generateFrameNames('crab1', 0, 25, '', 4), 30, true);
		crab.animations.play('swim');
		
		objects = [octopus, jellyfish, greenJellyfish, seahorse, stingray, purpleFish, crab];
		}
	
	function update() {
		if ((state == 1) && (crab.x <= 50)) {
			crab.x += 3;
		} else if (state == 1) {
			state = 2;
			button1 = game.add.button(game.world.centerX - 250, 250, 'button1', '', this);
			button2 = game.add.button(game.world.centerX + 10, 250, 'button2', toScene2, this);
		} else if (state == 2) {
		} else if (state == 3) {
			computer = game.add.sprite(560, 460, 'computer');
			computer.anchor.setTo(.5, .5);
			computer.scale.x *= .3;
			computer.scale.y *= .3;
			state = 301;
		} else if (state == 301) {
			if (crab.x <= 300) {
				crab.x += 3;
			} else {
				state = 4;
			}
		} else if (state == 4) {
			crab.y += 10 * Math.pow(-1, steep5_crab_jumps++);
			if (steep5_crab_jumps > 40) {
				state = 5;
			}
		} else if (state == 5) {
			email = game.add.sprite(560, 440, 'email');
			email.anchor.setTo(.5, .5);
			email.scale.x *= .3;
			email.scale.y *= .3;
			state = 6;
		} else if (state == 6) {
			email.y -= 7;
			if (email.y < -50) {
				state = 7;
			}
		} else if (state == 7) {
			button1 = game.add.button(game.world.centerX - 360, 250, 'button3', resetAll, this);
			state = 8;
		}
	}
	
	function toScene2 () {
		state = 3;
		button1.destroy();
		button2.destroy();
		for (var i=0; i < objects.length; ++i) {
			objects[i].y += 500;
		}
		crab.y -=500;
	}
	
	function resetAll () {
		button1.destroy();
		computer.destroy();
		email.destroy();
		for (var i=0; i < objects.length; ++i) {
			console.log(objects[i].y);
			objects[i].y -= 500;
		}
		crab.y += 500;
		crab.x = -150;
		state = 1;
	}
    </script>
</body>
</html>
